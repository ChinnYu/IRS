<!DOCTYPE html>
<html lang="zh-TW">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">
	<title>TeacherHome</title>
	<!-- Bootstrap core CSS-->
	<link href="./recourse/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<!-- Custom fonts for this template-->
	<link href="./recourse/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!-- Page level plugin CSS-->
	<link href="./recourse/vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">
	<!-- Custom styles for this template-->
	<link href="./recourse/css/sb-admin.css" rel="stylesheet">
	<!--TempStyle-->
	<style>
		body {
			font-family: "Lato", sans-serif;
		}
		/* Style the tab */
		div.tab {
			overflow: hidden;
			border: 1px solid #ccc;
			background-color: #f1f1f1;
		}
		/* Style the buttons inside the tab */
		div.tab button {
			background-color: inherit;
			float: left;
			border: none;
			outline: none;
			cursor: pointer;
			padding: 14px 16px;
			transition: 0.3s;
			font-size: 17px;
		}
		/* Change background color of buttons on hover */
		div.tab button:hover {
			background-color: #ddd;
		}
		/* Create an active/current tablink class */
		div.tab button.active {
			background-color: #ccc;
		}
		/* Style the tab content */
		.tabcontent {
			display: none;
			padding: 6px 12px;
			border: 1px solid #ccc;
			border-top: none;
		}
	</style>
	<!--TempStyleEnd-->
</head>

<body class="fixed-nav sticky-footer bg-dark" id="page-top">
	<!-- Navigation-->
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
		<a class="navbar-brand" href="./teacherHome">Querisma</a>
		<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive"
				aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarResponsive">
			<ul class="navbar-nav navbar-sidenav" id="exampleAccordion">
				<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Dashboard">
					<a class="nav-link" href="./teacherhome">
						<i class="fa fa-fw fa-dashboard"></i>
						<span class="nav-link-text">首頁</span>
					</a>
				</li>
				<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Charts">
					<a class="nav-link" href="charts.html">
						<i class="fa fa-fw fa-area-chart"></i>
						<span class="nav-link-text">測驗分析</span>
					</a>
				</li>
				<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Menu Levels">
					<a class="nav-link nav-link-collapse collapsed" data-toggle="collapse" href="#collapseMulti" data-parent="#exampleAccordion">
						<i class="fa fa-fw fa-sitemap"></i>
						<span class="nav-link-text">個人題庫</span>
					</a>
					<ul class="sidenav-second-level collapse" id="collapseMulti">
						<li>
							<a href="./newquestion">新增題目</a>
						</li>
						<li>
							<a href="./editquestion">題目整理</a>
						</li>
						<li>
							<a href="./newquiz">設計測驗</a>
						</li>
					</ul>
				</li>

				<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Charts">
					<a class="nav-link" href="./openclass">
						<i class="fa fa-fw fa-area-chart"></i>
						<span class="nav-link-text">開啟教室</span>
					</a>
				</li>

				<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Components">
					<a class="nav-link nav-link-collapse collapsed" data-toggle="collapse" href="#collapseComponents" data-parent="#exampleAccordion">
						<i class="fa fa-fw fa-wrench"></i>
						<span class="nav-link-text">頁面環境設置</span>
					</a>
					<ul class="sidenav-second-level collapse" id="collapseComponents">
						<li>
							<a href="navbar.html">頁面簡化</a>
						</li>
						<li>
							<a href="cards.html">Cards</a>
						</li>
					</ul>
				</li>
				<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Link">
					<a class="nav-link" href="#">
						<i class="fa fa-fw fa-link"></i>
						<span class="nav-link-text">Link</span>
					</a>
				</li>
			</ul>
			<ul class="navbar-nav sidenav-toggler">
				<li class="nav-item">
					<a class="nav-link text-center" id="sidenavToggler">
						<i class="fa fa-fw fa-angle-left"></i>
					</a>
				</li>
			</ul>
			<ul class="navbar-nav ml-auto">
				<li class="nav-item">
					<a class="nav-link" data-toggle="modal" data-target="#exampleModal">
						<i class="fa fa-fw fa-sign-out"></i>Logout</a>
				</li>
			</ul>
		</div>
	</nav>
	<div class="content-wrapper">
		<div class="container-fluid">
			<!-- Breadcrumbs-->
			<div class="row">
				<div class="col-md-12">
					<ol class="breadcrumb">
						<li class="breadcrumb-item">
							<a href="./teacherhome" id="teaname"></a>
						</li>
						<li class="breadcrumb-item active">首頁</li>
					</ol>
				</div>
			</div>
			<!--MainContent放這裡-->
			<div class="tab">
				<button class="tablinks" onclick="openCity(event, 'rank')" id="defaultOpen">得分排名</button>
				<!-- <button class="tablinks" onclick="IsExport()">匯出答案</button> -->
				<button class="tablinks" onclick="IsExport()">匯出排名</button>
			</div>

			<div id="rank" class="tabcontent">

				<div class="card mb-3">
					<div class="card-header">
						本次試題排名</div>
					<div class="card-body">
						<div class="row align-self-start justify-content-center">
							<div class="col-lg-1" style="text-align:center;">
								<i class="fa fa-user fa-5x" style="color:gold;"></i>
							</div>
							<div class="col-lg-6" style="text-align:center;">
								<font size="9" id="firstStudent"> 1st Student </font>
							</div>
						</div>
						<div class="row align-self-center justify-content-center">
							<div class="col-lg-1" style="text-align:center;">
								<i class="fa fa-user fa-4x" style="color:silver;"></i>
							</div>
							<div class="col-lg-6" style="text-align:center;">
								<font size="6" id="secondStudent"> 2nd Student</font>
							</div>
						</div>
						<div class="row align-self-end justify-content-center">
							<div class="col-lg-1" style="text-align:center;">
								<i class="fa fa-user fa-3x" style="color:burlywood"></i>
							</div>
							<div class="col-lg-6" style="text-align:center;">
								<font size="5" id="thirdStudent"> 3rd Student</font>
							</div>
						</div>
					</div>
					<div class="w-100"></div>
					<div class="row">
						<div class="col-lg-9">
							<div class="card mb-3">
								<div class="card-header">
									<i class="fa fa-area-chart"></i> 成績分布曲線</div>
								<div class="card-body">
									<canvas id="myAreaChart" width="100%" height="20%"></canvas>
								</div>
							</div>
						</div>
						<div class="col-lg-3">
							<div class="card mb-3">
								<div class="card-header">
									<i class="fa fa-pie-chart"></i> 答題分布圖</div>
								<div class="card-body">
									<canvas id="myPieChart" width="20%" height="20%"></canvas>
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
		<!--MainContentEnd-->
	</div>
	<!-- /.container-fluid-->
	<!-- /.content-wrapper-->
	<footer class="sticky-footer">
		<div class="container">
			<div class="text-center">
				<small>Copyright © Querisma 2017</small>
			</div>
		</div>
	</footer>
	<!-- Scroll to Top Button-->
	<a class="scroll-to-top rounded" href="#page-top">
		<i class="fa fa-angle-up"></i>
	</a>
	<!-- Logout Modal-->
	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
					<button class="close" type="button" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<div class="modal-body">確定退出系統?</div>
				<div class="modal-footer">
					<button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
					<a class="btn btn-primary" href="./logout">Logout</a>
				</div>
			</div>
		</div>
	</div>
	<!-- Bootstrap core JavaScript-->
	<script src="./recourse/vendor/jquery/jquery.min.js"></script>
	<script src="./recourse/vendor/popper/popper.min.js"></script>
	<script src="./recourse/vendor/bootstrap/js/bootstrap.min.js"></script>
	<!-- Core plugin JavaScript-->
	<script src="./recourse/vendor/jquery-easing/jquery.easing.min.js"></script>
	<!-- Page level plugin JavaScript-->
	<script src="./recourse/vendor/chart.js/Chart.min.js"></script>
	<script src="./recourse/vendor/datatables/jquery.dataTables.js"></script>
	<script src="./recourse/vendor/datatables/dataTables.bootstrap4.js"></script>
	<!-- Custom scripts for all pages-->
	<script src="./recourse/js/sb-admin.min.js"></script>
	<!-- Custom scripts for this page-->
	<script src="./recourse/js/sb-admin-datatables.min.js"></script>
	<script src="./recourse/js/sb-admin-charts.js">
	</script>



	<!--TempScript-->
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<!-- Get info-->
	<script text="text/Javascript">
		var numOfA = 0, numOfB = 0, numOfC = 0, numOfD = 0;
		var numOfZero = 0, numOfBottom = 0, numOfMean = 0, numOfTop = 0, numOfFull = 0;
		var dataOfExp = "";
		var nameListOfStu = "";
		var nameTarget = 0;
		var isFirName = 1;
		$.ajax({
			type: "POST",
			url: "teacherhome/infotohtml",
			dataType: "json",
			data: {
			},
			success: function (res) {
				if (res) {
					document.getElementById("teaname").innerHTML = res;
				}
			},
			error: function (jqXHR) {
				alert("發生錯誤: " + jqXHR.status);
			}
		});
		$.ajax({
			type: "POST",
			url: "GetQuizResult/takeQuizResult",
			dataType: "json",
			data: {},
			success: function (res) {
				if (res) {
					/* alert(res); */
					if (res.length == 0) {/* where if student less than 2 to do */
						document.getElementById('firstStudent').innerHTML = res[0]['user_Id'] + '  :  ' + res[0]['student_Quiz_Total_Score'] + '分';
					}
					if (res.length == 1) {/* where if student less than 2 to do */
						document.getElementById('firstStudent').innerHTML = res[0]['user_Id'] + '  :  ' + res[0]['student_Quiz_Total_Score'] + '分';
						document.getElementById('secondStudent').innerHTML = res[1]['user_Id'] + '  :  ' + res[1]['student_Quiz_Total_Score'] + '分';
					}
					else {
						for (var i = nameTarget; i < res.length - 1; i++) {
							if (isFirName == 1) {
								nameListOfStu = res[i]['user_Id'];
								isFirName = 0;
								/* console.log(nameListOfStu);
                                console.log(nameTarget); */
							}
							if (res[i]['student_Quiz_Total_Score'] == res[i + 1]['student_Quiz_Total_Score']) {
								nameListOfStu = nameListOfStu + ', ' + res[i + 1]['user_Id'];
								nameTarget++;
								/* console.log(nameListOfStu);
                                console.log(nameTarget); */
							} else { break; }
						}
						nameTarget++;
						document.getElementById('firstStudent').innerHTML = nameListOfStu + '  :  ' + res[nameTarget - 1]['student_Quiz_Total_Score'] + '分';
						nameListOfStu = null;
						isFirName = 1;
						/* console.log(nameListOfStu);
                        console.log(nameTarget); */
						for (var i = nameTarget; i < res.length - 1; i++) {
							if (isFirName == 1) {
								nameListOfStu = res[i]['user_Id'];
								isFirName = 0;
								/* console.log(nameListOfStu);
                                console.log(nameTarget); */
							}
							if (res[i]['student_Quiz_Total_Score'] == res[i + 1]['student_Quiz_Total_Score']) {
								nameListOfStu = nameListOfStu + ', ' + res[i + 1]['user_Id'];
								nameTarget++;
								/* console.log(nameListOfStu);
                                console.log(nameTarget); */
							} else { break; }
						}
						nameTarget++;
						document.getElementById('secondStudent').innerHTML = nameListOfStu + '  :  ' + res[nameTarget - 1]['student_Quiz_Total_Score'] + '分';
						nameListOfStu = null;
						isFirName = 1;
						/* console.log(nameListOfStu);
                        console.log(nameTarget); */
						for (var i = nameTarget; i < res.length - 1; i++) {
							if (isFirName == 1) {
								nameListOfStu = res[i]['user_Id'];
								isFirName = 0;
								/* console.log(nameListOfStu);
                                console.log(nameTarget); */
							}
							if (res[i]['student_Quiz_Total_Score'] == res[i + 1]['student_Quiz_Total_Score']) {
								nameListOfStu = nameListOfStu + ', ' + res[i + 1]['user_Id'];
								nameTarget++;
								/* console.log(nameListOfStu);
                                console.log(nameTarget); */
							} else { break; }
						}
						nameTarget++;
						document.getElementById('thirdStudent').innerHTML = nameListOfStu + '  :  ' + res[nameTarget - 1]['student_Quiz_Total_Score'] + '分';
						nameListOfStu = null;
						isFirName = 1;
						/* console.log(nameListOfStu);
                        console.log(nameTarget); */
						/* document.getElementById('firstStudent').innerHTML = res[0]['user_Id'] + '  :  ' + res[0]['student_Quiz_Total_Score'] + '分';
                        document.getElementById('secondStudent').innerHTML = res[1]['user_Id'] + '  :  ' + res[1]['student_Quiz_Total_Score'] + '分';
                        document.getElementById('thirdStudent').innerHTML = res[2]['user_Id'] + '  :  ' + res[2]['student_Quiz_Total_Score'] + '分'; */
						for (var i = 0; i < res.length; i++) {
							if (res[i]['answer_List'] == '1') numOfA++;/* count ABCD */
							if (res[i]['answer_List'] == '2') numOfB++;
							if (res[i]['answer_List'] == '4') numOfC++;
							if (res[i]['answer_List'] == '8') numOfD++;
							if (res[i]['student_Quiz_Total_Score'] == 0) numOfZero++;/* countScore */
							if (res[i]['student_Quiz_Total_Score'] < 250 && res[i]['student_Quiz_Total_Score'] > 0) numOfBottom++;
							if (res[i]['student_Quiz_Total_Score'] < 750 && res[i]['student_Quiz_Total_Score'] >= 250) numOfMean++
							if (res[i]['student_Quiz_Total_Score'] < 1000 && res[i]['student_Quiz_Total_Score'] >= 750) numOfTop++;
							if (res[i]['student_Quiz_Total_Score'] == 1000) numOfFull++;
						}
						myPieChart.data.datasets[0].data[0] = numOfA;/* draw piechart */
						myPieChart.data.datasets[0].data[1] = numOfB;
						myPieChart.data.datasets[0].data[2] = numOfC;
						myPieChart.data.datasets[0].data[3] = numOfD;
						myPieChart.update();
						myLineChart.data.datasets[0].data[0] = numOfZero;/* draw linechart */
						myLineChart.data.datasets[0].data[1] = numOfBottom;
						myLineChart.data.datasets[0].data[2] = numOfMean;
						myLineChart.data.datasets[0].data[3] = numOfTop;
						myLineChart.data.datasets[0].data[4] = numOfFull;
						myLineChart.options.scales.yAxes[0].ticks.max = res.length;
						myLineChart.update();
						for (var i = 0; i < res.length; i++) {
							for (var j = 0; j < 3; j++) {
								if (j > 0) {
									dataOfExp = dataOfExp + ",";
								}
								if (j == 0) dataOfExp = dataOfExp + res[i]['user_Id'];
								if (j == 1) {
									if (res[i]['answer_List'] == '1') { dataOfExp = dataOfExp + 'a'; }
									if (res[i]['answer_List'] == '2') { dataOfExp = dataOfExp + 'c'; }
									if (res[i]['answer_List'] == '4') { dataOfExp = dataOfExp + 'b'; }
									if (res[i]['answer_List'] == '8') { dataOfExp = dataOfExp + 'd'; }
								}
								if (j == 2) dataOfExp = dataOfExp + res[i]['student_Quiz_Total_Score'];
							}
							dataOfExp = dataOfExp + "\n";
						}
					}
				}
			},
			error: function (jqXHR) {
				alert("發生錯誤: " + jqXHR.status);
			}
		});
	</script>


	<script>
		function openCity(evt, cityName) {
			var i, tabcontent, tablinks;
			tabcontent = document.getElementsByClassName("tabcontent");
			for (i = 0; i < tabcontent.length; i++) {
				tabcontent[i].style.display = "none";
			}
			tablinks = document.getElementsByClassName("tablinks");
			for (i = 0; i < tablinks.length; i++) {
				tablinks[i].className = tablinks[i].className.replace(" active", "");
			}
			document.getElementById(cityName).style.display = "block";
			evt.currentTarget.className += " active";
		}
		document.getElementById("defaultOpen").click();
	</script>

	<!--Redirect-->
	<script>
		//彈窗確認是否匯出並返回首頁
		//記得改超連結位置
		function IsExport() {
			var r = confirm("是否匯出得分結果？");
			if (r == true) {
				createCsvFile();
				/* location.href = './logout'; */
			}
			else {
				/* location.href = './logout'; */
			}
		}
	</script>

	<!--CSV-->
	<script text="text/Javascript">
		var fileNameOfCSV = "";
		$.ajax({
			type: "POST",
			url: "GetQuizResult/takeCourseName",
			dataType: "json",
			data: {},
			success: function (res) {
				if (res) {
					fileNameOfCSV = fileNameOfCSV + res[0]['course_Year'] + '_' + res[0]['course_Term'] + '_' + res[0]['course_No'] + '_' + res[0]['course_Name'] + '_';
					waitforcourseinfo();
				}
			},
			error: function (jqXHR) {
				alert("發生錯誤: " + jqXHR.status);
			}
		});
		function waitforcourseinfo() {
			$.ajax({
				type: "POST",
				url: "GetQuizResult/takeQuizName",
				dataType: "json",
				data: {},
				success: function (res) {
					if (res) {
						fileNameOfCSV = fileNameOfCSV + res[0]['quiz_Name'];
					}
				},
				error: function (jqXHR) {
					alert("發生錯誤: " + jqXHR.status);
				}
			});
		}
		function createCsvFile() {
			var nowTime = new Date();
			var fileName = fileNameOfCSV + '_' + nowTime.getFullYear() + '_' + (nowTime.getMonth() + 1) + '_' + nowTime.getDate() + '_' + nowTime.getHours() + '_' + nowTime.getMinutes() + '_' + nowTime.getSeconds() + '.csv';//匯出的檔名
			var data = getRandomData();
			var blob = new Blob(['\uFEFF' + data], {
				type: "application/octet-stream"
			});
			var href = URL.createObjectURL(blob);
			var link = document.createElement("a");
			document.body.appendChild(link);
			link.href = href;
			link.download = fileName;
			link.click();
		}
		//隨機產生資料
		function getRandomData() {
			var header = "Name,Answer,Score\n";
			var data = dataOfExp;
			/*       for (var i = 0; i < 30; i++) {
                    for (var j = 0; j < 3; j++) {
                      if (j > 0) {
                        data = data + ",";
                      }
                      data = data + "Item" + i + "_" + j;
                    }
                    data = data + "\n";
                  } */
			return header + data;
		}
	</SCRIPT>
	<script text="text/Javascript">
		UTF8 = {
			encode: function (s) {
				for (var c, i = -1, l = (s = s.split("")).length, o = String.fromCharCode; ++i < l;
					 s[i] = (c = s[i].charCodeAt(0)) >= 127 ? o(0xc0 | (c >>> 6)) + o(0x80 | (c & 0x3f)) : s[i]);
				return s.join("");
			},
			decode: function (s) {
				for (var a, b, i = -1, l = (s = s.split("")).length, o = String.fromCharCode, c = "charCodeAt"; ++i < l;
					 ((a = s[i][c](0)) & 0x80) && (s[i] = (a & 0xfc) == 0xc0 && ((b = s[i + 1][c](0)) & 0xc0) == 0x80 ? o(((a & 0x03) << 6) + (b & 0x3f)) : o(128), s[++i] = ""));
				return s.join("");
			}
		};
	</script>
	<!--TempScriptEnd-->
	</div>
</body>

</html>
